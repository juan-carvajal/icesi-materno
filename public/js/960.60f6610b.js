"use strict";(self["webpackChunkicesi_materno"]=self["webpackChunkicesi_materno"]||[]).push([[960],{42960:(e,a,l)=>{l.r(a),l.d(a,{default:()=>ve});var t=l(83673),n=l(82942);const o=e=>((0,t.dD)("data-v-4d2e03c5"),e=e(),(0,t.Cn)(),e),s=(0,t.Uk)("Mensajes"),i={key:1,class:"column"},u=o((()=>(0,t._)("p",{class:"text-center"}," Selecciona una conversación o comienza una nueva ",-1)));function r(e,a,l,o,r,c){const d=(0,t.up)("q-btn"),m=(0,t.up)("q-toolbar-title"),p=(0,t.up)("q-toolbar"),v=(0,t.up)("q-header"),g=(0,t.up)("q-separator"),h=(0,t.up)("q-item-section"),f=(0,t.up)("q-item"),w=(0,t.up)("q-list"),b=(0,t.up)("q-scroll-area"),C=(0,t.up)("q-drawer"),q=(0,t.up)("chat"),Z=(0,t.up)("q-page"),D=(0,t.up)("q-page-container"),W=(0,t.up)("q-layout"),_=(0,t.Q2)("ripple");return(0,t.wg)(),(0,t.j4)(W,{view:"hHh Lpr lff",class:"shadow-2 rounded-borders"},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{elevated:"",class:"bg-black"},{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(d,{flat:"",onClick:a[0]||(a[0]=a=>e.drawer=!e.drawer),round:"",dense:"",icon:"chat_bubble"}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[s])),_:1}),(0,t.Wm)(d,{flat:"",to:"/",round:"",dense:"",icon:"home"})])),_:1})])),_:1}),(0,t.Wm)(C,{modelValue:e.drawer,"onUpdate:modelValue":a[1]||(a[1]=a=>e.drawer=a),breakpoint:500,overlay:"",bordered:"",class:"bg-grey-3"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{class:"fit"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{class:"full-width",flat:"",label:"Nueva Conversación",icon:"inbox",color:"primary",onClick:e.openNewChatDialog},null,8,["onClick"]),(0,t.Wm)(g),(0,t.Wm)(w,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.chats,((a,l)=>((0,t.wg)(),(0,t.iD)(t.HY,{key:l},[(0,t.wy)((0,t.Wm)(f,{onClick:l=>e.currentChat=a,clickable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(a.name||"(Conversación sin nombre)"),1)])),_:2},1024)])),_:2},1032,["onClick"]),[[_]]),(0,t.Wm)(g)],64)))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.Wm)(D,null,{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"message-page flex flex-center relative-position"},{default:(0,t.w5)((()=>[e.currentChat?((0,t.wg)(),(0,t.j4)(q,{key:0,chatID:e.currentChat.ID,chatTitle:e.currentChat.name,onNameChange:e.updateChatRef},null,8,["chatID","chatTitle","onNameChange"])):((0,t.wg)(),(0,t.iD)("div",i,[u,(0,t.Wm)(d,{color:"primary",icon:"inbox",label:"Nueva conversación",onClick:e.openNewChatDialog},null,8,["onClick"])]))])),_:1})])),_:1})])),_:1})}var c=l(9594),d=l(61442),m=l(12942);function p(e){const a=(0,c.iH)([]),l=(0,c.iH)(),n=(0,c.iH)(!1);function o(){l.value&&l.value(),n.value=!0;const t=(0,d.IO)((0,d.hJ)(m.db,"chats",e.value,"messages"),(0,d.Xo)("sentDate","desc"));l.value=(0,d.cf)(t,(e=>{a.value=[],e.forEach((e=>{const l=e.data();a.value.push(l)})),n.value=!1}),(e=>{console.log(e),n.value=!1}),(()=>{n.value=!1}))}return(0,t.YP)([e],o,{immediate:!0}),{chats:a,isLoading:n}}function v(e){const a=(0,c.iH)([]),l=(0,c.iH)(),n=(0,c.iH)(!1);function o(){l.value&&l.value(),n.value=!0;const t=(0,d.IO)((0,d.hJ)(m.db,"chats"),(0,d.ar)("participants","array-contains",e.value),(0,d.Xo)("lastUpdated","desc"));l.value=(0,d.cf)(t,(e=>{a.value=[],e.forEach((e=>{const l=e.data();l.ID=e.id,a.value.push(l)})),n.value=!1}),(e=>{console.log(e),n.value=!1}),(()=>{n.value=!1}))}return(0,t.YP)([e],o,{immediate:!0}),{chats:a,isLoading:n}}var g=l(48879),h=l(12730);const f={class:"fit absolute column q-ma-xl"},w={class:"col-10 q-pa-xs scroll",ref:"divRef"},b={class:"column reverse"};function C(e,a,l,n,o,s){const i=(0,t.up)("q-inner-loading"),u=(0,t.up)("q-input"),r=(0,t.up)("avatar-vue"),c=(0,t.up)("q-chat-message"),d=(0,t.up)("q-icon");return(0,t.wg)(),(0,t.iD)("div",f,[(0,t.Wm)(i,{showing:e.isLoading,label:"Cargando...","label-class":"text-primary","label-style":"font-size: 1.1em"},null,8,["showing"]),(0,t.Wm)(u,{class:"col-1 full-width q-px-sm","model-value":e.chatTitle,"onUpdate:modelValue":e.updateChatName,placeholder:"Chat sin titulo",debounce:"500"},null,8,["model-value","onUpdate:modelValue"]),(0,t._)("div",w,[(0,t._)("div",b,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.chats,((a,l)=>((0,t.wg)(),(0,t.j4)(c,{key:l,name:a.sender===e.currentUserData.uid?"Yo":a.senderEmail??a.sender,"bg-color":a.sender===e.currentUserData.uid?"primary":"secondary",avatar:"https://cdn.quasar.dev/img/avatar1.jpg",text:[a.message],sent:a.sender===e.currentUserData.uid,stamp:a?.sentDate?.toDate()?.toLocaleString()??""},{avatar:(0,t.w5)((()=>[(0,t.Wm)(r,{class:"q-mx-sm",email:a.senderEmail??a.sender},null,8,["email"])])),_:2},1032,["name","bg-color","text","sent","stamp"])))),128))])],512),(0,t.Wm)(u,{modelValue:e.messageText,"onUpdate:modelValue":a[0]||(a[0]=a=>e.messageText=a),type:"text",filled:"",class:"col-1 full-width q-px-sm",onKeydown:(0,h.D2)((0,h.iM)(e.sendMessage,["prevent"]),["enter"])},(0,t.Nv)({_:2},[e.messageText?{name:"append",fn:(0,t.w5)((()=>[(0,t.Wm)(d,{onClick:e.sendMessage,name:"send",class:"cursor-pointer"},null,8,["onClick"])]))}:void 0]),1032,["modelValue","onKeydown"])])}var q=l(32446);const Z=(0,t.aZ)({components:{AvatarVue:q.Z},props:{chatID:{required:!0,type:String},chatTitle:{required:!0,type:String}},emits:["nameChange"],methods:{},setup(e,{emit:a}){const{chatID:l}=(0,c.BK)(e),n=(0,c.iH)(""),o=(0,c.iH)(),{chats:s,isLoading:i}=p(l);function u(){o.value&&(o.value.scrollTop=o.value.scrollHeight)}(0,t.YP)(i,(()=>{(0,t.Y3)((()=>{u()}))}));const r=(0,g.useStore)(),v=(0,c.Fl)((()=>({uid:r.state.auth.uid??"",email:r.state.auth.email})));function h(e){(0,d.r7)((0,d.JU)(m.db,`chats/${l.value}`),{name:e}).then((()=>{a("nameChange")})).catch((e=>{console.log(e)}))}function f(){if(!n.value)return;if(!v.value)return;const e={sender:v.value.uid,senderEmail:v.value.email,message:n.value,sentDate:(0,d.Bt)()};(0,d.ET)((0,d.hJ)(m.db,`chats/${l.value}/messages`),e),n.value=""}return{chats:s,isLoading:i,currentUserData:v,messageText:n,sendMessage:f,divRef:o,scrollToBottom:u,updateChatName:h}}});var D=l(74260),W=l(66941),_=l(64689),k=l(40629),y=l(24554),Q=l(7518),U=l.n(Q);const x=(0,D.Z)(Z,[["render",C]]),H=x;U()(Z,"components",{QInnerLoading:W.Z,QInput:_.Z,QChatMessage:k.Z,QIcon:y.Z});const I=(0,t._)("div",{class:"text-h6 ellipsis"},"Nueva Conversación",-1),S={class:"q-gutter-xs"},L={class:"text-grey-8 q-gutter-xs"};function N(e,a,l,o,s,i){const u=(0,t.up)("q-card-section"),r=(0,t.up)("q-input"),c=(0,t.up)("q-icon"),d=(0,t.up)("q-chip"),m=(0,t.up)("q-item-label"),p=(0,t.up)("q-item-section"),v=(0,t.up)("q-btn"),g=(0,t.up)("q-item"),f=(0,t.up)("q-list"),w=(0,t.up)("q-scroll-area"),b=(0,t.up)("q-separator"),C=(0,t.up)("q-card-actions"),q=(0,t.up)("q-form"),Z=(0,t.up)("q-card"),D=(0,t.up)("q-dialog");return(0,t.wg)(),(0,t.j4)(D,{ref:"dialogRef",onHide:e.onDialogHide},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{class:"full-width",bordered:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,null,{default:(0,t.w5)((()=>[I])),_:1}),(0,t.Wm)(q,{onSubmit:(0,h.iM)(e.createConversation,["prevent"])},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{class:"row q-col-gutter-sm"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"Nombre de la conversación",placeholder:"(sin nombre)",class:"col-12","stack-label":"",modelValue:e.conversationName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.conversationName=a)},null,8,["modelValue"]),(0,t.Wm)(r,{label:"Buscar participantes",modelValue:e.searchString,"onUpdate:modelValue":a[1]||(a[1]=a=>e.searchString=a),debounce:500,class:"col-12",type:"search",loading:e.isLoading},{append:(0,t.w5)((()=>[(0,t.Wm)(c,{name:"search"})])),_:1},8,["modelValue","loading"]),(0,t._)("div",S,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.selectedUsers,((a,l)=>((0,t.wg)(),(0,t.j4)(d,{key:l,removable:"","model-value":!0,onRemove:l=>e.removeSelectedUser(a.uid),color:"primary","text-color":"white"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(a.email),1)])),_:2},1032,["onRemove"])))),128))]),e.queriedUsers.length>0?((0,t.wg)(),(0,t.j4)(w,{key:0,class:"full-width",style:{height:"200px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(f,null,{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.queriedUsers,((a,l)=>((0,t.wg)(),(0,t.j4)(g,{clickable:"",key:l},{default:(0,t.w5)((()=>[(0,t.Wm)(p,null,{default:(0,t.w5)((()=>[(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(a.firstName)+" "+(0,n.zw)(a.lastName),1)])),_:2},1024),(0,t.Wm)(m,{caption:""},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(a.email),1)])),_:2},1024)])),_:2},1024),(0,t.Wm)(p,{side:""},{default:(0,t.w5)((()=>[(0,t._)("div",L,[(0,t.Wm)(v,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"add",onClick:l=>e.addSelectedUser(a),disable:!!e.selectedUsers.find((e=>e.uid===a.uid))},null,8,["onClick","disable"])])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(b),(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[(0,t.Wm)(v,{color:"negative",onClick:e.onDialogCancel,flat:"",label:"Cancelar"},null,8,["onClick"]),(0,t.Wm)(v,{disable:0===e.selectedUsers.length,color:"primary",type:"submit",label:"Crear"},null,8,["disable"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["onHide"])}var T=l(91701),V=l(48825),Y=l(33672),R=l.n(Y);function j(e,a){const l=(0,c.iH)([]),n=(0,c.iH)(!1),o="WINEUDJGO6",s="cbf5f5501b2bc512061daf63c548d470",i=R()(o,s),u=i.initIndex(e);return(0,t.YP)(a,(()=>{a.value&&(n.value=!0,l.value=[],u.search(a.value).then((e=>{l.value=e.hits.map((e=>e))})).finally((()=>{n.value=!1})))}),{immediate:!0}),{results:l,isLoading:n}}function E(e){const{results:a,isLoading:l}=j("user-search",e);return{users:a,isLoading:l}}const K=(0,t.aZ)({emits:[...T.Z.emits],setup(){const{dialogRef:e,onDialogHide:a,onDialogOK:l,onDialogCancel:t}=(0,T.Z)(),n=(0,c.iH)(""),o=(0,c.iH)([]),{users:s,isLoading:i}=E(n),{notify:u}=(0,V.Z)(),r=(0,g.useStore)(),p=(0,c.Fl)((()=>r.state.auth.uid??"")),v=(0,c.iH)("");function h(e){if(!e)return;const a=o.value.findIndex((a=>a.uid===e));-1!==a&&o.value.splice(a,1)}function f(e){const a=o.value.find((a=>a.uid===e.uid));a||o.value.push(e)}function w(){if(!p.value)return;const e=[...o.value.filter((e=>!!e.uid)).map((e=>e.uid)),p.value];(0,d.ET)((0,d.hJ)(m.db,"chats"),{name:v.value,participants:e,lastUpdated:new Date}).then((()=>{u({type:"positive",message:"Conversación creada con éxito"})})).catch((e=>{console.log(e),u({type:"negative",message:"Error creando conversación."})}))}const b=(0,c.Fl)((()=>s.value.filter((e=>e.uid!==p.value))));return{dialogRef:e,onDialogHide:a,onDialogOK:l,onDialogCancel:t,searchString:n,queriedUsers:b,isLoading:i,selectedUsers:o,removeSelectedUser:h,addSelectedUser:f,conversationName:v,createConversation:w}}});var z=l(46778),M=l(10151),B=l(25589),J=l(68689),P=l(67030),F=l(47704),O=l(27011),A=l(83414),X=l(52035),$=l(2350),G=l(2165),ee=l(65869),ae=l(99367);const le=(0,D.Z)(K,[["render",N]]),te=le;U()(K,"components",{QDialog:z.Z,QCard:M.Z,QCardSection:B.Z,QForm:J.Z,QInput:_.Z,QIcon:y.Z,QChip:P.Z,QScrollArea:F.Z,QList:O.Z,QItem:A.Z,QItemSection:X.Z,QItemLabel:$.Z,QBtn:G.Z,QSeparator:ee.Z,QCardActions:ae.Z});const ne=(0,t.aZ)({components:{Chat:H},setup(){const e=(0,g.useStore)(),a=(0,c.iH)(),l=(0,c.Fl)((()=>e.state.auth.uid??"")),{dialog:t}=(0,V.Z)(),{chats:n,isLoading:o}=v(l);function s(){a.value&&(a.value=n.value.find((e=>e.ID===a.value?.ID)))}function i(){t({component:te})}return{drawer:(0,c.iH)(!0),chats:n,isLoading:o,currentChat:a,updateChatRef:s,openNewChatDialog:i}}});var oe=l(19214),se=l(53812),ie=l(39570),ue=l(13747),re=l(52901),ce=l(72652),de=l(24379),me=l(46489);const pe=(0,D.Z)(ne,[["render",r],["__scopeId","data-v-4d2e03c5"]]),ve=pe;U()(ne,"components",{QLayout:oe.Z,QHeader:se.Z,QToolbar:ie.Z,QBtn:G.Z,QToolbarTitle:ue.Z,QDrawer:re.Z,QScrollArea:F.Z,QSeparator:ee.Z,QList:O.Z,QItem:A.Z,QItemSection:X.Z,QIcon:y.Z,QPageContainer:ce.Z,QPage:de.Z}),U()(ne,"directives",{Ripple:me.Z})}}]);