"use strict";(self["webpackChunkicesi_materno"]=self["webpackChunkicesi_materno"]||[]).push([[737],{6737:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ve});var o=a(83673);const i=(0,o.Uk)(" Podcasts ");function s(e,t,a,s,n,l){const c=(0,o.up)("q-icon"),d=(0,o.up)("q-toolbar-title"),r=(0,o.up)("q-space"),u=(0,o.up)("q-btn"),p=(0,o.up)("q-toolbar"),m=(0,o.up)("podcast-line"),f=(0,o.up)("q-list"),g=(0,o.up)("podcast-player"),h=(0,o.up)("q-dialog"),w=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(w,{class:"q-ma-md"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"text-primary q-px-none"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{name:"podcasts"}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[i])),_:1}),(0,o.Wm)(r),e.hasAccess("podcasts.write")?((0,o.wg)(),(0,o.j4)(u,{key:0,onClick:e.openDialog,flat:"",round:"",icon:"add"},null,8,["onClick"])):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.podcasts,(t=>((0,o.wg)(),(0,o.j4)(m,{onClick:a=>e.selectPodcast(t),key:t.ID,podcast:t},null,8,["onClick","podcast"])))),128))])),_:1}),(0,o.Wm)(h,{modelValue:e.podcastDialogOpen,"onUpdate:modelValue":t[0]||(t[0]=t=>e.podcastDialogOpen=t),seamless:"",position:"bottom"},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{podcast:e.selectedPodcast},null,8,["podcast"])])),_:1},8,["modelValue"])])),_:1})}var n=a(9594),l=a(48825),c=a(12730),d=a(82942);const r={class:"text-h6"},u={class:"fit flex flex-center"},p=(0,o._)("div",{class:"text-caption"},"Max: 2Mb",-1),m={class:"text-h5 q-mt-sm q-mb-xs"},f={class:"text-caption text-grey"};function g(e,t,a,i,s,n){const l=(0,o.up)("q-card-section"),g=(0,o.up)("q-btn"),h=(0,o.up)("q-img"),w=(0,o.up)("q-input"),v=(0,o.up)("q-icon"),y=(0,o.up)("q-file"),Z=(0,o.up)("q-separator"),R=(0,o.up)("q-card-actions"),q=(0,o.up)("q-form"),k=(0,o.up)("q-card"),W=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.j4)(W,{ref:"dialogRef",onHide:e.onDialogHide},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{class:"full-width",bordered:""},{default:(0,o.w5)((()=>[(0,o.Wm)(q,{onSubmit:(0,c.iM)(e.handleFormSubmit,["prevent"])},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o._)("div",r,(0,d.zw)(e.podcast.ID?"Editando Podcast":"Nuevo podcast")+": "+(0,d.zw)(e.internalPodcast.title),1)])),_:1}),(0,o.Wm)(l,{class:"row wrap"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,{class:"col-12 col-sm-6 flex flex-center"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{class:"rounded-borders",src:e.imageSourceComputed,ratio:"1",onClick:e.pickImageFile},{default:(0,o.w5)((()=>[(0,o._)("div",u,[(0,o.Wm)(g,{round:"",size:"lg",flat:"",icon:"edit"})])])),_:1},8,["src","onClick"]),p])),_:1}),(0,o.Wm)(l,{class:"col-12 col-sm-6"},{default:(0,o.w5)((()=>[(0,o._)("div",m,[(0,o.Wm)(w,{required:"",modelValue:e.internalPodcast.title,"onUpdate:modelValue":t[0]||(t[0]=t=>e.internalPodcast.title=t),label:"Titulo"},null,8,["modelValue"])]),(0,o._)("div",f,[(0,o.Wm)(w,{label:"Descripción",modelValue:e.internalPodcast.description,"onUpdate:modelValue":t[1]||(t[1]=t=>e.internalPodcast.description=t),type:"textarea",required:""},null,8,["modelValue"])]),(0,o.Wm)(y,{accept:".mp3, audio/mpeg",modelValue:e.file,"onUpdate:modelValue":t[2]||(t[2]=t=>e.file=t),label:"Media",hint:"Solo mp3"},{prepend:(0,o.w5)((()=>[(0,o.Wm)(v,{name:"audiotrack"})])),_:1},8,["modelValue"]),(0,o.Wm)(y,{modelValue:e.imageFile,"onUpdate:modelValue":t[3]||(t[3]=t=>e.imageFile=t),ref:"imageFilePickerRef","max-file-size":"2097152",style:{display:"none"},onRejected:e.handleImageFileRejection,accept:".jpg, image/*"},null,8,["modelValue","onRejected"])])),_:1})])),_:1}),(0,o.Wm)(Z),(0,o.Wm)(R,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{type:"submit",flat:"",color:"primary",disable:!e.file&&!e.podcast.ID},{default:(0,o.w5)((()=>[(0,o.Uk)((0,d.zw)(e.podcast.ID?"Editar":"Crear"),1)])),_:1},8,["disable"])])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1},8,["onHide"])}var h=a(91701),w=a(12942),v=a(13277),y=a(61442),Z=a(44259);const R=(0,o.aZ)({props:{podcast:{type:Object,required:!0}},async mounted(){this.podcast.imageURL&&(this.accessURLToResource=await(0,v.Jt)((0,v.iH)(w.storage,this.podcast.imageURL)).catch((e=>(console.log(e),""))))},data(){return{internalPodcast:{...this.podcast},file:null,imageFile:null,imageSource:"",accessURLToResource:""}},emits:["ok","hide"],watch:{imageFile:"handleImageFileChange"},methods:{async handleFormSubmit(){try{if(!this.file&&!this.internalPodcast.ID)return;this.loading.show();const e=`podcast/images/${(0,Z.Z)()}`,t=(0,v.iH)(w.storage,e);if(this.imageFile&&(await(0,v.KV)(t,this.imageFile),this.internalPodcast.imageURL=e),this.file){const e=`podcast/media/${(0,Z.Z)()}.mp3`,t=(0,v.iH)(w.storage,e);await(0,v.KV)(t,this.file),this.internalPodcast.mediaURL=e}if(!this.internalPodcast.ID)return await(0,y.ET)((0,y.hJ)(w.db,"podcasts"),this.internalPodcast),void this.notify({type:"positive",message:"Podcast creado con éxito"});await(0,y.r7)((0,y.JU)(w.db,"podcasts",this.internalPodcast.ID),this.internalPodcast),this.notify({type:"positive",message:"Podcast editado con éxito"})}catch(e){console.log(e),this.notify({type:"negative",message:"Error creando podcast."})}finally{this.$q.loading.hide(),this.dialogRef?.hide()}},handleImageFileRejection(e){this.notify({type:"negative",message:"Error cambiando imagen: "+e[0].failedPropValidation})},handleImageFileChange(e){if(!e)return void(this.imageSource="");if(!e.type.startsWith("image"))return;const t=new FileReader;t.onloadend=e=>{this.imageSource=String(e.target?.result)},t.readAsDataURL(e)}},computed:{imageSourceComputed(){return this.imageSource?this.imageSource:this.accessURLToResource?this.accessURLToResource:""}},setup(){const e=(0,n.iH)(),{notify:t,loading:a}=(0,l.Z)();function o(){e.value&&e.value.pickFiles()}const{dialogRef:i,onDialogHide:s,onDialogOK:c,onDialogCancel:d}=(0,h.Z)();return{notify:t,loading:a,dialogRef:i,onDialogHide:s,onOKClick(){c()},onCancelClick:d,imageFilePickerRef:e,pickImageFile:o}}});var q=a(74260),k=a(46778),W=a(10151),_=a(68689),b=a(25589),P=a(24027),Q=a(2165),C=a(64689),D=a(64974),U=a(24554),L=a(65869),S=a(99367),I=a(7518),x=a.n(I);const F=(0,q.Z)(R,[["render",g]]),H=F;function V(){const e=(0,n.iH)([]),t=(0,y.IO)((0,y.hJ)(w.db,"podcasts"),(0,y.Xo)("creationDate","desc"));return(0,y.cf)(t,(t=>{e.value=[],t.forEach((t=>{const a=t.data();a.ID=t.id,e.value.push(a)}))})),{podcasts:e}}function A(e,t,a,i,s,n){const l=(0,o.up)("q-img"),r=(0,o.up)("q-avatar"),u=(0,o.up)("q-item-section"),p=(0,o.up)("q-item-label"),m=(0,o.up)("q-btn"),f=(0,o.up)("q-item"),g=(0,o.Q2)("ripple");return(0,o.wy)(((0,o.wg)(),(0,o.j4)(f,{clickable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{avatar:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{rounded:""},{default:(0,o.w5)((()=>[e.podcast.imageURL?((0,o.wg)(),(0,o.j4)(l,{key:0,"placeholder-src":"icons/favicon-32x32.png",fit:"fill",class:"fit",src:e.imageURL},null,8,["src"])):((0,o.wg)(),(0,o.j4)(l,{key:1,fit:"fill",class:"fit",src:"icons/favicon-32x32.png"}))])),_:1})])),_:1}),(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{class:"text-bold"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,d.zw)(e.podcast.title),1)])),_:1}),(0,o.Wm)(p,{caption:"",lines:"2"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,d.zw)(e.podcast.description),1)])),_:1})])),_:1}),(0,o.Wm)(u,{side:""},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{onClick:(0,c.iM)(e.openEditDialog,["stop"]),icon:"edit",flat:"",round:""},null,8,["onClick"])])),_:1})])),_:1},512)),[[g]])}x()(R,"components",{QDialog:k.Z,QCard:W.Z,QForm:_.Z,QCardSection:b.Z,QImg:P.Z,QBtn:Q.Z,QInput:C.Z,QFile:D.Z,QIcon:U.Z,QSeparator:L.Z,QCardActions:S.Z});var j=a(48879);const z=(0,o.aZ)({props:{podcast:{type:Object,required:!0}},data(){return{imageURL:""}},setup(){const e=(0,j.useStore)(),t=(0,n.Fl)((()=>e.state.auth?.permissions??[]));return{userPermissions:t}},mounted(){this.podcast.imageURL&&(0,v.Jt)((0,v.iH)(w.storage,this.podcast.imageURL)).then((e=>{this.imageURL=e}))},watch:{"podcast.imageURL":{handler(e){e&&(0,v.Jt)((0,v.iH)(w.storage,this.podcast.imageURL)).then((e=>{this.imageURL=e}))}}},methods:{openEditDialog(){this.$q.dialog({component:H,componentProps:{podcast:this.podcast}})}}});var O=a(83414),T=a(52035),E=a(75096),J=a(2350),K=a(46489);const M=(0,q.Z)(z,[["render",A]]),B=M;x()(z,"components",{QItem:O.Z,QItemSection:T.Z,QAvatar:E.Z,QImg:P.Z,QItemLabel:J.Z,QIcon:U.Z,QBtn:Q.Z}),x()(z,"directives",{Ripple:K.Z});const $={class:"text-weight-bold"},N={class:"text-grey"};function X(e,t,a,i,s,n){const l=(0,o.up)("q-space"),c=(0,o.up)("q-btn"),r=(0,o.up)("q-card-section"),u=(0,o.up)("controlled-audio-wave-form"),p=(0,o.up)("q-spinner-puff"),m=(0,o.up)("q-inner-loading"),f=(0,o.up)("q-card"),g=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(f,{style:{"max-width":"70vw"}},{default:(0,o.w5)((()=>[(0,o.Wm)(r,{class:"row items-center no-wrap"},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o._)("div",$,(0,d.zw)(e.podcast.title),1),(0,o._)("div",N,(0,d.zw)(e.podcast.description),1)]),(0,o.Wm)(l),(0,o.Wm)(c,{flat:"",round:"",onClick:e.playAudio,icon:"play_arrow"},null,8,["onClick"]),(0,o.Wm)(c,{flat:"",round:"",onClick:e.stopAudio,icon:"pause"},null,8,["onClick"]),(0,o.wy)((0,o.Wm)(c,{flat:"",round:"",icon:"close"},null,512),[[g]])])),_:1}),(0,o.Wm)(r,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{ref:"waveFormRef",audioSource:e.audioLinkRef},null,8,["audioSource"])])),_:1}),(0,o.Wm)(m,{showing:!e.audioLinkRef},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{size:"50px",color:"primary"})])),_:1},8,["showing"])])),_:1})}const Y={key:0},G=["src"];function ee(e,t,a,i,s,n){const l=(0,o.up)("av-waveform");return e.audioSource?((0,o.wg)(),(0,o.iD)("div",Y,[(0,o._)("audio",{ref:"audioRef",style:{display:"none"},crossorigin:"anonymous",src:e.audioSource,autoplay:""},null,8,G),(0,o.Wm)(l,{"line-color":"lime","canv-class":"fit","ref-link":"audioRef","playtime-font-family":"Roboto"})])):(0,o.kq)("",!0)}const te=(0,o.aZ)({props:{audioSource:{type:String,required:!0}},setup(){const e=(0,n.iH)();function t(){e.value&&e.value.play().catch((t=>{console.log(t),console.log(e.value)}))}function a(){e.value&&e.value.pause()}return{audioRef:e,playAudio:t,stopAudio:a}},watch:{audioSource:{immediate:!0,handler(e){e&&this.playAudio()}}}}),ae=(0,q.Z)(te,[["render",ee]]),oe=ae,ie=(0,o.aZ)({components:{ControlledAudioWaveForm:oe},props:{podcast:{type:Object,required:!0}},setup(){const e=(0,n.iH)(),t=(0,n.iH)();function a(){t.value?.playAudio()}function o(){t.value?.stopAudio()}return{audioLinkRef:e,playAudio:a,stopAudio:o,waveFormRef:t}},watch:{podcast:{immediate:!0,handler(e){e&&(this.audioLinkRef="",this.stopAudio(),(0,v.Jt)((0,v.iH)(w.storage,e.mediaURL)).then((e=>{this.audioLinkRef=e})).catch((e=>{console.log(e)})))}}}});var se=a(62025),ne=a(66941),le=a(8430),ce=a(60677);const de=(0,q.Z)(ie,[["render",X]]),re=de;x()(ie,"components",{QCard:W.Z,QCardSection:b.Z,QSpace:se.Z,QBtn:Q.Z,QInnerLoading:ne.Z,QSpinnerPuff:le.Z}),x()(ie,"directives",{ClosePopup:ce.Z});var ue=a(86809);const pe=(0,o.aZ)({components:{PodcastLine:B,PodcastPlayer:re},setup(){const e=(0,l.Z)(),t=(0,o.f3)("currentUser"),{hasAccess:a}=(0,ue.Z)(t),i=(0,n.iH)(),s=(0,n.iH)(),{podcasts:c}=V();function d(){const t={title:"",description:"",creationDate:new Date};e.dialog({component:H,componentProps:{podcast:t}})}return{openDialog:d,podcasts:c,audioRef:i,selectedPodcast:s,hasAccess:a}},methods:{selectPodcast(e){this.selectedPodcast=e,this.podcastDialogOpen=!0}},data(){return{search:"",podcastDialogOpen:!1}}});var me=a(24379),fe=a(39570),ge=a(13747),he=a(27011);const we=(0,q.Z)(pe,[["render",s]]),ve=we;x()(pe,"components",{QPage:me.Z,QToolbar:fe.Z,QIcon:U.Z,QToolbarTitle:ge.Z,QSpace:se.Z,QBtn:Q.Z,QList:he.Z,QDialog:k.Z})}}]);