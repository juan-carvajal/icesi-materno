(self["webpackChunkicesi_materno"]=self["webpackChunkicesi_materno"]||[]).push([[850],{45053:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>Ge});var l=t(83673),o=t(82942);const s=(0,l.Uk)(" Casos "),n={class:"row q-gutter-sm q-mb-sm"},i={class:"row q-gutter-sm col-grow"},r={class:"text-subtitle2 text-grey text-center ellipsis"};function c(e,a,t,c,u,d){const m=(0,l.up)("q-icon"),p=(0,l.up)("q-toolbar-title"),g=(0,l.up)("q-space"),f=(0,l.up)("q-btn"),b=(0,l.up)("q-toolbar"),w=(0,l.up)("q-select"),v=(0,l.up)("q-linear-progress"),y=(0,l.up)("q-card-section"),h=(0,l.up)("q-separator"),q=(0,l.up)("case-card"),C=(0,l.up)("draggable"),_=(0,l.up)("q-card"),S=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(S,{class:"q-ma-md column"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{class:"text-primary q-px-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{name:"cases"}),(0,l.Wm)(p,null,{default:(0,l.w5)((()=>[s])),_:1}),(0,l.Wm)(g),e.hasAccess("alerts.write")?((0,l.wg)(),(0,l.j4)(f,{key:0,flat:"",round:"",icon:"add",onClick:e.createNewCase},null,8,["onClick"])):(0,l.kq)("",!0)])),_:1}),(0,l._)("div",n,[(0,l.Wm)(w,{label:"Responsable",modelValue:e.selectedEmails,"onUpdate:modelValue":a[0]||(a[0]=a=>e.selectedEmails=a),multiple:"",options:e.availableEmails,counter:"","max-values":10,"stack-label":"",dense:"",outlined:"",style:{width:"250px"},clearable:""},null,8,["modelValue","options"]),(0,l.Wm)(w,{modelValue:e.caseTypeCategory,"onUpdate:modelValue":a[1]||(a[1]=a=>e.caseTypeCategory=a),options:e.caseTypeCategoryOption,"stack-label":"",dense:"",outlined:"","emit-value":"",label:"Estado"},null,8,["modelValue","options"])]),(0,l._)("div",i,[e.isLoading?((0,l.wg)(),(0,l.j4)(v,{key:0,query:""})):(0,l.kq)("",!0),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.caseStates,(a=>((0,l.wg)(),(0,l.j4)(_,{class:"col bg-grey-2",flat:"",key:a},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l._)("div",r,(0,o.zw)(a),1)])),_:2},1024),(0,l.Wm)(h),(0,l.Wm)(C,{list:e.filteredCases(a),class:"column q-gutter-y-sm q-pa-sm",tag:"div",key:`column-${a}`,group:{name:a,pull:!0,put:!0},"item-key":"ID",animation:120,onChange:t=>e.checkAdd(t,a)},{item:(0,l.w5)((({element:a})=>[(0,l.Wm)(q,{onClick:t=>e.editCase(a),class:"cursor-pointer",caseProp:a},null,8,["onClick","caseProp"])])),_:2},1032,["list","group","onChange"])])),_:2},1024)))),128))])])),_:1})}var u,d=t(9594),m=t(53786),p=t(86485),g=t(61442),f=t(12942);function b(e,a){const t=(0,d.iH)([]),o=(0,d.iH)(),s=(0,d.iH)(!1);function n(){o.value&&o.value(),s.value=!0;const l=[];if(e.value&&e.value.length>0){const a=e.value.slice(0,10).map((e=>"Sin asignar"===e?null:e));a.includes(null)?l.push((0,g.ar)("assignee","==",null)):l.push((0,g.ar)("assignee.email","in",a))}l.push((0,g.ar)("state",a.value===u.ACTIVE?"!=":"==",m.jr.RESOLVED)),a.value===u.ACTIVE&&l.push((0,g.Xo)("state","asc")),l.push((0,g.Xo)("lastUpdateState","asc"));const n=(0,g.IO)((0,g.hJ)(f.db,"cases"),...l);o.value=(0,g.cf)(n,(e=>{t.value=[],e.forEach((e=>{const a=e.data();a.ID=e.id,t.value.push(a)})),s.value=!1}),(e=>{console.log(e),s.value=!1}),(()=>{s.value=!1}))}return(0,l.YP)([e,a],n,{immediate:!0}),{cases:t,isLoading:s}}(function(e){e["ACTIVE"]="Activos",e["ARCHIVED"]="Archivados"})(u||(u={}));var w=t(40470),v=t.n(w),y=t(48825),h=t(48879),q=t(12730);const C={class:"text-h6 ellipsis"};function _(e,a,t,s,n,i){const r=(0,l.up)("q-card-section"),c=(0,l.up)("q-select"),u=(0,l.up)("q-separator"),d=(0,l.up)("q-input"),m=(0,l.up)("q-icon"),p=(0,l.up)("q-item-section"),g=(0,l.up)("q-item-label"),f=(0,l.up)("q-item"),b=(0,l.up)("q-btn"),w=(0,l.up)("q-space"),v=(0,l.up)("q-card-actions"),y=(0,l.up)("q-form"),h=(0,l.up)("case-tabs-vue"),_=(0,l.up)("q-card"),S=(0,l.up)("q-dialog");return(0,l.wg)(),(0,l.j4)(S,{ref:"dialogRef",onHide:e.onDialogHide,"full-height":!!e.caseState.ID,"full-width":!!e.caseState.ID},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{class:"full-width",bordered:""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,null,{default:(0,l.w5)((()=>[(0,l._)("div",C,(0,o.zw)(e.caseState.ID?"Editar Caso":"Crear Caso")+": "+(0,o.zw)(e.caseState.title),1)])),_:1}),(0,l.Wm)(y,{onSubmit:(0,q.iM)(e.onOKClick,["prevent"])},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{class:"row q-col-gutter-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(c,{class:"col-12",label:"Tipo de caso",options:e.caseTypes,modelValue:e.caseState.type,"onUpdate:modelValue":a[0]||(a[0]=a=>e.caseState.type=a),rules:[e=>!!e||"Este campo es requerido"],filled:""},null,8,["options","modelValue","rules"])])),_:1}),(0,l.Wm)(u,{inset:""}),(0,l.Wm)(r,{class:"row q-col-gutter-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{class:"col-12",type:"text",label:"Título",outlined:"",modelValue:e.caseState.title,"onUpdate:modelValue":a[1]||(a[1]=a=>e.caseState.title=a),maxlength:"50",counter:"",rules:[e=>!!e||"Este campo es requerido"]},null,8,["modelValue","rules"]),(0,l.Wm)(d,{class:"col-12",type:"textarea",label:"Descripción",outlined:"",maxlength:"2500",counter:"",modelValue:e.caseState.description,"onUpdate:modelValue":a[2]||(a[2]=a=>e.caseState.description=a)},null,8,["modelValue"]),(0,l.Wm)(c,{class:"col-12 col-sm-6",label:"Responsable",filled:"",modelValue:e.caseState.assignee,"onUpdate:modelValue":a[3]||(a[3]=a=>e.caseState.assignee=a),onFilter:e.filterFn,options:e.assigneeOptions,"option-label":"email",clearable:""},null,8,["modelValue","onFilter","options"]),(0,l.Wm)(c,{class:"col-12 col-sm-6",label:"Prioridad",filled:"",options:e.casePriorities,"map-options":"",modelValue:e.caseState.priority,"onUpdate:modelValue":a[4]||(a[4]=a=>e.caseState.priority=a),"emit-value":""},(0,l.Nv)({option:(0,l.w5)((e=>[(0,l.Wm)(f,(0,o.vs)((0,l.F4)(e.itemProps)),{default:(0,l.w5)((()=>[(0,l.Wm)(p,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{color:e.opt.color,name:e.opt.icon},null,8,["color","name"])])),_:2},1024),(0,l.Wm)(p,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.opt.label),1)])),_:2},1024)])),_:2},1024)])),_:2},1040)])),_:2},[Number.isNaN(e.caseState?.priority)?void 0:{name:"prepend",fn:(0,l.w5)((()=>[(0,l.Wm)(m,{color:e.getCasePriorityProps(e.caseState.priority).color,name:e.getCasePriorityProps(e.caseState.priority).icon},null,8,["color","name"])]))}]),1032,["options","modelValue"])])),_:1}),(0,l.Wm)(u),(0,l.Wm)(v,{align:"right"},{default:(0,l.w5)((()=>[e.caseState.ID&&e.hasAccess("alerts.write")?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l.Wm)(b,{label:"Alerta",onClick:a[5]||(a[5]=a=>e.createAlertDialog(e.caseState.ID)),color:"negative",icon:"warning",disable:!e.caseState.ID},null,8,["disable"]),(0,l.Wm)(w)],64)):(0,l.kq)("",!0),(0,l.Wm)(b,{color:"negative",onClick:e.onCancelClick,flat:"",label:"Cancelar"},null,8,["onClick"]),(0,l.Wm)(b,{color:"primary",type:"submit",label:e.caseState.ID?"Actualizar":"Crear"},null,8,["label"])])),_:1})])),_:1},8,["onSubmit"]),e.targetCase.ID?((0,l.wg)(),(0,l.iD)(l.HY,{key:0},[(0,l.Wm)(u),(0,l.Wm)(h,{caseID:e.targetCase.ID},null,8,["caseID"])],64)):(0,l.kq)("",!0)])),_:1})])),_:1},8,["onHide","full-height","full-width"])}var S=t(91701),Z=t(73439),k=t(1906);function W(e,a,t,s,n,i){const r=(0,l.up)("q-tab"),c=(0,l.up)("q-tabs"),u=(0,l.up)("q-separator"),d=(0,l.up)("case-comment-manager-vue"),m=(0,l.up)("q-tab-panel"),p=(0,l.up)("case-files-manager-vue"),g=(0,l.up)("q-item-label"),f=(0,l.up)("q-item-section"),b=(0,l.up)("q-icon"),w=(0,l.up)("q-badge"),v=(0,l.up)("q-item"),y=(0,l.up)("q-list"),h=(0,l.up)("q-tab-panels");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(c,{modelValue:e.tab,"onUpdate:modelValue":a[0]||(a[0]=a=>e.tab=a),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{name:"comments",label:"Comentarios"}),(0,l.Wm)(r,{name:"files",label:"Adjuntos"}),(0,l.Wm)(r,{name:"alerts",label:"Alertas"})])),_:1},8,["modelValue"]),(0,l.Wm)(u),(0,l.Wm)(h,{modelValue:e.tab,"onUpdate:modelValue":a[1]||(a[1]=a=>e.tab=a),animated:""},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{name:"comments"},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{caseID:e.caseID},null,8,["caseID"])])),_:1}),(0,l.Wm)(m,{name:"files"},{default:(0,l.w5)((()=>[(0,l.Wm)(p,{caseID:e.caseID},null,8,["caseID"])])),_:1}),(0,l.Wm)(m,{name:"alerts"},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{dense:"",separator:""},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.alerts,((a,t)=>((0,l.wg)(),(0,l.j4)(v,{to:`/alerts/${a.id}`,key:t},{default:(0,l.w5)((()=>[(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(`Alerta creado por ${a?.createdBy?.displayName||a?.createdBy?.email}`),1)])),_:2},1024),(0,l.Wm)(g,{caption:"",lines:"3"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.description),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(f,{side:"",top:""},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)("Creada "+e.getTimeInterval(e.handleFirebaseDate(a.createdAt))),1)])),_:2},1024),(0,l.Wm)(w,{class:"text-bold text-caption q-my-xs",color:a.acknowledgedBy?"warning":"negative"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.acknowledgedBy?`Atendida por ${a.acknowledgedBy.displayName||a.acknowledgedBy.email}`:"Sin Atender"),1),a.acknowledgedBy?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(b,{key:0,name:"warning",color:"white"}))])),_:2},1032,["color"])])),_:2},1024)])),_:2},1032,["to"])))),128))])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}var D=t(23470),I=t(85944);const Q={class:"q-pa-md q-gutter-sm"},x={class:"row"},V={class:"column"},A={class:"text-bold"},z={class:"text-caption"},T=["innerHTML"];function H(e,a,t,s,n,i){const r=(0,l.up)("avatar-vue"),c=(0,l.up)("q-card-section"),u=(0,l.up)("q-separator"),d=(0,l.up)("q-card"),m=(0,l.up)("q-editor"),p=(0,l.up)("q-btn");return(0,l.wg)(),(0,l.iD)("div",Q,[(0,l.Wm)(d,{flat:""},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.caseComments,((a,t)=>((0,l.wg)(),(0,l.iD)(l.HY,{key:t},[(0,l.Wm)(c,{class:"col"},{default:(0,l.w5)((()=>[(0,l._)("div",x,[(0,l.Wm)(r,{class:"q-mr-sm",email:a.createdBy.email||a.createdBy.displayName},null,8,["email"]),(0,l._)("div",V,[(0,l._)("p",A,(0,o.zw)(a.createdBy.email||a.createdBy.displayName),1),(0,l._)("p",z,(0,o.zw)(e.getTimeInterval(e.handleFirebaseDate(a.createdAt))),1)])]),(0,l._)("div",{innerHTML:e.sanitizeHtml(a.text)},null,8,T)])),_:2},1024),(0,l.Wm)(u)],64)))),128))])),_:1}),(0,l.Wm)(m,{modelValue:e.qeditor,"onUpdate:modelValue":a[0]||(a[0]=a=>e.qeditor=a),dense:e.$q.screen.lt.md,toolbar:[[{label:e.$q.lang.editor.align,icon:e.$q.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]},{label:e.$q.lang.editor.align,icon:e.$q.iconSet.editor.align,fixedLabel:!0,options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:e.$q.lang.editor.formatting,icon:e.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:e.$q.lang.editor.fontSize,icon:e.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:e.$q.lang.editor.defaultFont,icon:e.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}},null,8,["modelValue","dense","toolbar"]),(0,l.Wm)(p,{disable:!e.qeditor,onClick:e.AddComment,label:"Comentar",color:"primary"},null,8,["disable","onClick"])])}var U=t(17079),j=t(94215),P=t(55610),B=t.n(P),E=t(32446),F=t(75361);const N=(0,l.aZ)({props:{caseID:{type:String,required:!0}},components:{AvatarVue:E.Z},setup(e){const a=(0,d.iH)(""),{caseID:t}=(0,d.BK)(e),{docs:l,error:o}=(0,j.J)("caseComments",(0,U.ar)("caseID","==",t.value),(0,U.Xo)("createdAt","desc")),{notify:s}=(0,y.Z)();function n(){const e=(0,F.v0)().currentUser;if(!e)return;const{uid:l,email:o,displayName:n}=e,i={uid:l,email:o,displayName:n};(0,U.ET)((0,U.hJ)(f.db,"caseComments"),{text:a.value,createdAt:new Date,createdBy:i,caseID:t.value}).then((()=>{a.value=""})).catch((e=>{console.log(e),s({type:"negative",message:"Ha ocurrido un error creando el comentario."})}))}return{qeditor:a,caseComments:l,error:o,sanitizeHtml:B(),handleFirebaseDate:I.VP,getTimeInterval:I.Cr,AddComment:n}}});var $=t(74260),L=t(10151),O=t(25589),K=t(65869),M=t(40154),Y=t(2165),R=t(7518),J=t.n(R);const G=(0,$.Z)(N,[["render",H]]),X=G;J()(N,"components",{QCard:L.Z,QCardSection:O.Z,QSeparator:K.Z,QEditor:M.Z,QBtn:Y.Z});const ee={colspan:"5"},ae=(0,l._)("tr",null,[(0,l._)("th",{class:"text-center text-bold"},"Archivo"),(0,l._)("th",{class:"text-center text-bold"},"Tipo"),(0,l._)("th",{class:"text-center text-bold"},"Tamaño"),(0,l._)("th",{class:"text-center text-bold"},"Descripción"),(0,l._)("th",{class:"text-center text-bold"},"Acciones")],-1),te={class:"text-center"},le={class:"text-center"},oe={class:"text-center"},se={class:"text-center"},ne={class:"text-center"},ie={key:1},re=(0,l._)("td",{colspan:"5",class:"text-bold"},"No hay archivos adjuntos",-1),ce=[re];function ue(e,a,t,s,n,i){const r=(0,l.up)("q-item-label"),c=(0,l.up)("q-item-section"),u=(0,l.up)("q-icon"),d=(0,l.up)("q-item"),m=(0,l.up)("q-list"),p=(0,l.up)("q-separator"),g=(0,l.up)("q-space"),f=(0,l.up)("q-btn"),b=(0,l.up)("q-toolbar"),w=(0,l.up)("q-file"),v=(0,l.up)("q-input"),y=(0,l.up)("q-markup-table"),h=(0,l.up)("q-form"),C=(0,l.up)("q-card-section"),_=(0,l.up)("q-card");return(0,l.wg)(),(0,l.j4)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(C,null,{default:(0,l.w5)((()=>[e.caseData?.attachments?((0,l.wg)(),(0,l.j4)(m,{key:0},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.caseData.attachments,((a,t)=>((0,l.wg)(),(0,l.j4)(d,{key:t},{default:(0,l.w5)((()=>[(0,l.Wm)(c,null,{default:(0,l.w5)((()=>[(0,l.Wm)(r,{lines:"2"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.description),1)])),_:2},1024),(0,l.Wm)(r,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.mimeType),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(c,{side:""},{default:(0,l.w5)((()=>[a.path?((0,l.wg)(),(0,l.j4)(u,{key:0,name:"download",class:"cursor-pointer",onClick:t=>e.downloadAttachment(a?.path??"")},null,8,["onClick"])):(0,l.kq)("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})):(0,l.kq)("",!0),e.hasAccess("cases.write")?((0,l.wg)(),(0,l.iD)(l.HY,{key:1},[(0,l.Wm)(p,{class:"q-my-sm"}),(0,l.Wm)(h,{onSubmit:(0,q.iM)(e.submitFiles,["prevent"])},{default:(0,l.w5)((()=>[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",ee,[(0,l.Wm)(b,{class:"fit q-px-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(g),(0,l.Wm)(f,{icon:"add",label:"Nuevo",color:"primary",onClick:a[0]||(a[0]=a=>e.files.push({}))}),e.files.length>0?((0,l.wg)(),(0,l.j4)(f,{key:0,class:"q-ml-sm",icon:"upload",type:"submit",label:"Subir",color:"positive"})):(0,l.kq)("",!0)])),_:1})])]),ae]),(0,l._)("tbody",null,[e.files.length>0?((0,l.wg)(!0),(0,l.iD)(l.HY,{key:0},(0,l.Ko)(e.files,((a,t)=>((0,l.wg)(),(0,l.iD)("tr",{key:t},[(0,l._)("td",te,[(0,l.Wm)(w,{hint:`Máximo ${e.humanStorageSize(e.maxFileSize)}`,filled:"",required:"","max-file-size":e.maxFileSize,modelValue:a.file,"onUpdate:modelValue":e=>a.file=e},null,8,["hint","max-file-size","modelValue","onUpdate:modelValue"])]),(0,l._)("td",le,(0,o.zw)(a.file?.type),1),(0,l._)("td",oe,(0,o.zw)(e.humanStorageSize(a.file?.size??0)),1),(0,l._)("td",se,[(0,l.Wm)(v,{type:"text",filled:"",required:"",modelValue:a.description,"onUpdate:modelValue":e=>a.description=e},null,8,["modelValue","onUpdate:modelValue"])]),(0,l._)("td",ne,[(0,l._)("div",null,[(0,l.Wm)(f,{icon:"delete",color:"red",onClick:a=>e.files.splice(t,1),round:""},null,8,["onClick"])])])])))),128)):((0,l.wg)(),(0,l.iD)("tr",ie,ce))])])),_:1})])),_:1},8,["onSubmit"])],64)):(0,l.kq)("",!0)])),_:1})])),_:1})}var de=t(82130),me=t(86466),pe=t(44259),ge=t(33437),fe=t(16423),be=t(86809);const{humanStorageSize:we}=de.ZP,ve=(0,l.aZ)({props:{caseID:{type:String,required:!0}},setup(e){const a=20971520,t=(0,d.iH)([]),{caseID:l}=(0,d.BK)(e),{notify:o,loading:s}=(0,y.Z)(),{docData:n}=(0,j.H)((0,d.iH)("cases"),l),{currentUser:i}=(0,fe.xJ)(),{hasAccess:r}=(0,be.Z)(i),c=(0,d.iH)({});async function u(e){if(e in c.value)return void(0,ge.Z)(c.value[e]);const a=await(0,me.Jt)((0,me.iH)(f.storage,e));c.value[e]=a,(0,ge.Z)(a)}function m(){s.show(),Promise.all(t.value.map((async e=>{let a="";const t=e.file?.name.split(".");t&&t.length>0&&(a=`.${t.pop()??""}`);const o=`cases/${l.value}/files/${(0,pe.Z)()}${a}`,s=(0,me.iH)(f.storage,o),n=await(e.file?.arrayBuffer());return n?(0,me.KV)(s,n,{contentType:e.file?.type}).then((()=>{const a={path:o,mimeType:e.file?.type,size:e.file?.size,description:e.description,uploadedBy:""};return a})):Promise.reject("Could not retrieve file contents")}))).then((e=>(0,g.r7)((0,g.JU)(f.db,"cases",l.value),{attachments:(0,g.vr)(...e)}))).then((()=>{o({message:"Adjuntos agregados con éxito.",type:"positive"}),t.value=[]})).catch((e=>{console.log(e),o({message:"Falla agregando adjuntos.",type:"negative"})})).finally((()=>{s.hide()}))}return{files:t,humanStorageSize:we,maxFileSize:a,caseData:n,submitFiles:m,downloadAttachment:u,hasAccess:r}}});var ye=t(27011),he=t(83414),qe=t(52035),Ce=t(2350),_e=t(24554),Se=t(68689),Ze=t(30481),ke=t(39570),We=t(62025),De=t(64974),Ie=t(64689);const Qe=(0,$.Z)(ve,[["render",ue]]),xe=Qe;J()(ve,"components",{QCard:L.Z,QCardSection:O.Z,QList:ye.Z,QItem:he.Z,QItemSection:qe.Z,QItemLabel:Ce.Z,QIcon:_e.Z,QSeparator:K.Z,QForm:Se.Z,QMarkupTable:Ze.Z,QToolbar:ke.Z,QSpace:We.Z,QBtn:Y.Z,QFile:De.Z,QInput:Ie.Z});const Ve=(0,l.aZ)({props:{caseID:{type:String,required:!0}},components:{CaseCommentManagerVue:X,CaseFilesManagerVue:xe},setup(e){const a=(0,d.iH)(),{caseID:t}=(0,d.BK)(e),{alerts:l}=(0,D.Z7)(50,(0,g.ar)("relatedCaseID","==",t.value));return{tab:a,alerts:l,getTimeInterval:I.Cr,handleFirebaseDate:I.VP}}});var Ae=t(57547),ze=t(3269),Te=t(5906),He=t(86602),Ue=t(47704),je=t(69721);const Pe=(0,$.Z)(Ve,[["render",W]]),Be=Pe;J()(Ve,"components",{QTabs:Ae.Z,QTab:ze.Z,QSeparator:K.Z,QTabPanels:Te.Z,QTabPanel:He.Z,QScrollArea:Ue.Z,QList:ye.Z,QItem:he.Z,QItemSection:qe.Z,QItemLabel:Ce.Z,QBadge:je.Z,QIcon:_e.Z});const Ee=(0,l.aZ)({props:{targetCase:{type:Object,required:!0}},components:{CaseTabsVue:Be},emits:[...S.Z.emits],setup(e){const a=Object.values(m.bl),t=Object.values(m.jr),l=(0,d.iH)([]),{targetCase:o}=(0,d.BK)(e),s=(0,d.iH)(o.value),{notify:n,loading:i,dialog:r}=(0,y.Z)(),{currentUser:c}=(0,fe.xJ)(),{hasAccess:u}=(0,be.Z)(c),p=(0,Z.$C)(),b=(0,Z.V1)(p,"users-GetCaseAssignableUsers"),{dialogRef:w,onDialogHide:v,onDialogOK:h,onDialogCancel:q}=(0,S.Z)();function C(e){e&&r({component:k.Z,componentProps:{relatedCaseID:e}})}function _(e){switch(e){case m.dh.LOW:return{color:"blue",icon:"low_priority",label:"Prioridad baja",value:e};case m.dh.NORMAL:return{color:"green",icon:"lens",label:"Prioridad normal",value:e};case m.dh.HIGH:return{color:"red",icon:"priority_high",label:"Prioridad alta",value:e};default:return{color:"purple",icon:"question_mark",label:"Prioridad desconocida",value:e}}}const W=(0,d.Fl)((()=>Object.keys(m.dh).filter((e=>!isNaN(Number(e)))).map((e=>_(Number(e)))))),D=()=>(0,g.ET)((0,g.hJ)(f.db,"cases"),s.value).then((()=>{n({type:"positive",message:"Caso creado con éxito"})})).catch((e=>{console.log(e),n({type:"negative",message:"Error creando caso."})})),I=()=>s.value?.ID?(0,g.r7)((0,g.JU)(f.db,`cases/${s.value.ID}`),s.value).then((()=>{n({type:"positive",message:"Caso actualizado con éxito"})})).catch((e=>{console.log(e),n({type:"negative",message:"Error actualizado caso."})})):Promise.resolve();return{dialogRef:w,hasAccess:u,onDialogHide:v,onOKClick(){i.show();const e=s.value.ID?I():D();e.finally((()=>{i.hide(),h()}))},onCancelClick:q,caseTypes:a,caseStates:t,caseState:s,casePriorities:W,getCasePriorityProps:_,assigneeOptions:l,createAlertDialog:C,filterFn(e,a){0===l.value.length?b().then((e=>{l.value=e.data})).then((()=>{a()})):a()}}}});var Fe=t(46778),Ne=t(72448),$e=t(99367);const Le=(0,$.Z)(Ee,[["render",_]]),Oe=Le;J()(Ee,"components",{QDialog:Fe.Z,QCard:L.Z,QCardSection:O.Z,QForm:Se.Z,QSelect:Ne.Z,QSeparator:K.Z,QInput:Ie.Z,QItem:he.Z,QItemSection:qe.Z,QIcon:_e.Z,QItemLabel:Ce.Z,QCardActions:$e.Z,QBtn:Y.Z,QSpace:We.Z});const Ke=(0,l.aZ)({components:{CaseCard:p.Z,draggable:v()},setup(){const e=(0,y.Z)(),a=(0,h.useStore)(),t=(0,d.iH)(Object.values(m.jr)),o=(0,d.iH)(u.ACTIVE),s=(0,d.iH)([]),n=(0,l.f3)("currentUser"),{hasAccess:i}=(0,be.Z)(n),{cases:r,isLoading:c}=b(s,o);function p(){const e={title:"",type:m.bl.ADMINISTRATIVE,state:m.jr.TODO,created:new Date,lastUpdateState:new Date,reported:{email:a.state.auth.email,uid:a.state.auth.uid},priority:m.dh.NORMAL};w(e)}function w(a){e.dialog({component:Oe,componentProps:{targetCase:a}})}function v(e){w(e)}function q(e){return r.value.filter((a=>a.state===e))}function C(e,a){e.added&&e?.added?.element?.ID&&(0,g.r7)((0,g.JU)(f.db,"cases",e.added.element.ID),{state:a}).catch((e=>{console.log(e)}))}(0,l.YP)(s,(()=>{s.value&&s.value.includes("Sin asignar")&&s.value.length>1&&(s.value=["Sin asignar"])}));const _=(0,d.Fl)((()=>{if(!r.value)return[];if(s.value&&s.value.includes("Sin asignar"))return["Sin asignar"];const e=Array.from(new Set(r.value.filter((e=>!!e.assignee?.email)).map((e=>e.assignee?.email??""))));return e.push("Sin asignar"),e}));return{caseStates:t,isLoading:c,cases:r,filteredCases:q,checkAdd:C,openDialog:w,createNewCase:p,editCase:v,hasAccess:i,caseTypeCategoryOption:Object.values(u).map((e=>({label:e,value:e}))),caseTypeCategory:o,availableEmails:_,selectedEmails:s}}});var Me=t(24379),Ye=t(13747),Re=t(51598);const Je=(0,$.Z)(Ke,[["render",c]]),Ge=Je;J()(Ke,"components",{QPage:Me.Z,QToolbar:ke.Z,QIcon:_e.Z,QToolbarTitle:Ye.Z,QSpace:We.Z,QBtn:Y.Z,QSelect:Ne.Z,QLinearProgress:Re.Z,QCard:L.Z,QCardSection:O.Z,QSeparator:K.Z})},75347:()=>{},31777:()=>{},34017:()=>{},59905:()=>{},64604:()=>{}}]);